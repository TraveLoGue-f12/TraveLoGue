{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>TraveLoGue</title>
{% endblock meta %}

{% block script %} 
<script>
    $(document).ready(function(){
        $.get("/event/json/", function(data) {
            console.log(data)
            for (i=0; i<data.length; i++){
                $("#cards").append(`
                <div class="col-lg-4 col-sm-6">
                    <div class="post-item position-relative h-100">
                    <div class="post-img position-relative overflow-hidden">
                        <img src="${data[i].fields.imageURL}" class="img-fluid" alt="">
                        <span class="post-date">${data[i].fields.date}</span>
                    </div>
                    <div class="post-content d-flex flex-column">
                        <h3 class="post-title">${data[i].fields.title}</h3>
                        <p>${data[i].fields.description}</p>
                        <hr>
                        <a href="event-detail/${data[i].pk}" class="readmore stretched-link"><span>Read more</span><i class="bi bi-arrow-right"></i></a>
                    </div>
                    </div>
                </div>`)
            }
        });
        
        let files
        $('#image').on('change', function (event) {
            files = event.target.files
            console.log(files)
        })


        $("#submit_event").click(function(){
            const formData = new FormData()
            formData.append('image', files[0])
            formData.append('title', $("#title").val())
            formData.append('place', $("#place").val())
            formData.append('date', $("#date").val())
            formData.append('description', $("#description").val())
            formData.append('category', $("#category").val())

            $.ajax({
                url: '/event/add-new/', // point to server-side URL
                dataType: 'json', // what to expect back from server
                cache: false,
                contentType: false,
                processData: false,
                data: formData,
                type: 'post',
                success: function(result){
                    // console.log(result)
                    $("#cards").append(`
                    <div class="col-lg-4 col-sm-6">
                        <div class="post-item position-relative h-100">
                        <div class="post-img position-relative overflow-hidden">
                            <img src="${result.fields.image.url}" class="img-fluid" alt="">
                            <span class="post-date">${result.fields.date}</span>
                        </div>
                        <div class="post-content d-flex flex-column">
                            <h3 class="post-title">${result.fields.title}</h3>
                            <p>${result.fields.description}</p>
                            <hr>
                            <a href="event-detail/${result.pk}" class="readmore stretched-link"><span>Read more</span><i class="bi bi-arrow-right"></i></a>
                        </div>
                        </div>
                    </div>`);
                    $("#image").val(''),
                    $("#title").val(''),
                    $("#place").val(''),
                    $("#date").val(''),
                    $("#description").val(''),
                    $("#category").val('')
                    alert("Event has added")
                },
                error: function (response) {
                    $('#msg').html(response.message); // display error response
                }
            });
        });

    });
</script>
{% endblock script %}

{% block content %}

<style>
    .centered {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);

    }

    .card-img-top {
        border-radius: 15px;
        border-color: transparent;
    }

    .card {
        border-radius: 15px;
        border-color: transparent;
    }
    .darkened {
        filter: brightness(50%);
        border-radius: 15px;
        border-color: transparent;
    }
    .recent-blog-posts .post-item:hover .post-img img {
        transform: scale(1.1);
    }

    .blog .card:hover img {
        transform: scale(1.1);
        transition: 0.7s;
    }

    .recent-blog-posts .post-item .post-img img {
        transition: 0.5s;
    }
</style>
<div class="breadcrumbs d-flex align-items-center" style="background-image: url(/static/img/planner-bc.jpg);">
    <div class="container position-relative d-flex flex-column align-items-center aos-init aos-animate" data-aos="fade">
        <h2>Upcoming Local Events</h2>
        <ol><li>Enjoy your trip to Indonesia by visiting local events. Find the upcoming events here.</li></ol>
        <!-- <p data-aos="fade-up">Enjoy your trip to Indonesia by visiting local events. Find the upcoming events here.</p> -->
        <ol><li><a href="{% url 'main:index' %}">Home</a></li><li>Events</li></ol>
    </div>
</div>

<div id="blog" class="blog" style="padding-top: 30px">
    <div class="d-flex justify-content-between align-items-center" style="padding-left: 140px; padding-right: 140px; padding-bottom: 30px;">
        <div>
            <h1>Local Events</h1>
        </div>
        {% if detector %}
            <div>
                <button type="button" class="btn btn-default my-auto" data-toggle="modal" data-target="#createTaskModal">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                    <span style="font-size:1.5rem">&nbsp;Add New Event</span>
                </button>
                <button type="button" class="btn btn-default my-auto" style="border-color: #feb900; background-color: #feb900;">
                    <span aria-hidden="true"></span>
                    <a style="font-size:1.5rem" class="text-decoration-none text-white" href="{% url 'Event:show_user_event' %}">My Event</a>
                </button>   
            </div>
        {% endif %}
    </div>

    <div class="container" style="padding-left: 20px; padding-right: 20px;">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
                <a href="{% url 'Event:show_music_event' %}">
                    <div class="card" >
                        <img src="https://sgp1.digitaloceanspaces.com/tz-mag-id/wp-content/uploads/2022/03/080803034545/Preview-Prambanan-Jazz-Festival-2022.jpg" class="card-img-top overflow-hidden darkened" style="max-width: 700px; max-height:325px; border-radius: 15px;" alt="...">
                        <div class="centered fade-in-image" style="font-family:Arial; color:white; font-size:160%;">Music</div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'Event:show_culinary_event' %}">
                    <div class="card" >
                        <img src="https://student-activity.binus.ac.id/bssc/wp-content/uploads/sites/38/2021/11/kenet-artikel.jpg" class="card-img-top overflow-hidden darkened" style="max-width: 700px; max-height:325px; border-radius: 15px;" alt="...">
                        <div class="centered fade-in-image" style="font-family:Arial; color:white; font-size:160%;">Culinary</div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'Event:show_festival_event' %}">
                    <div class="card" >
                        <img src="https://visitjawatengah.jatengprov.go.id/assets/images/5da4dd23-c13a-428d-8bbd-998f42fbcf61.jpg" class="card-img-top overflow-hidden darkened" style="max-width: 700px; max-height:325px; border-radius: 15px;" alt="...">
                        <div class="centered fade-in-image" style="font-family:Arial; color:white; font-size:160%;">Festival</div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'Event:show_sport_event' %}">
                    <div class="card" >
                        <img src="https://3.bp.blogspot.com/-3hEh6tLLTKU/W9D8rr7LgGI/AAAAAAAAFJo/7nf2dhqB-O89SXrsmxgVLa8uh9fKta4kQCLcBGAs/s1600/sport%2Btourism.JPG" class="card-img-top overflow-hidden darkened" style="max-width: 700px; max-height:325px; border-radius: 15px;" alt="...">
                        <div class="centered fade-in-image" style="font-family:Arial; color:white; font-size:160%;">Sport</div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'Event:show_culture_event' %}">
                    <div class="card" >
                        <img src="https://www.ngopibareng.id/images/uploads/2022/2022-01-14/tari-kecak-merajut-asa-menuai-mimpi-pulihkan-wisata-di-bali--thumbnail-252" class="card-img-top overflow-hidden darkened" style="max-width: 700px; max-height:325px; border-radius: 15px;" alt="...">
                        <div class="centered fade-in-image" style="font-family:Arial; color:white; font-size:160%;">Culture</div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'Event:show_others_event' %}">
                    <div class="card" >
                        <img src="https://img.jakpost.net/c/2017/06/07/2017_06_07_28299_1496823022._large.jpg" class="card-img-top overflow-hidden darkened" style="max-width: 700px; max-height:325px; border-radius: 15px;" alt="...">
                        <div class="centered fade-in-image" style="font-family:Arial; color:white; font-size:160%;">Others</div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

    <div class="modal fade" id="createTaskModal" tabindex="-1" role="dialog" aria-labelledby="createTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: rgb(255, 255, 255);">
                <div class="modal-header text-gray-300" style="background-color: rgb(255, 255, 255);">
                    <h5 class="modal-title text-gray-300">Add New Event!</h5>
                </div>
                <div class="modal-body" style="background-color: rgb(255, 255, 255);">
                    <div class="flex justify-center">
                        <div class="lg:w-64 mt-3">
                            <!-- <form method="POST" action="" class="register-form" enctype="multipart/form-data" id="eventForm"> -->
                            {% csrf_token %}
                            <div class="input-box">
                                <span class="details" for="title" style="font-weight: 700;">Event title :</span><br>
                                <input type="text" id="title" name="title"><br>
                            </div>
                            <div class="input-box">
                                <span class="details" for="category" style="font-weight: 700;">Event Category :</span><br>
                                <select id="category" name="category">
                                    <option value="Music">Music</option>
                                    <option value="Culinary">Culinary</option>
                                    <option value="Sport">Sport</option>
                                    <option value="Culture">Culture</option>
                                    <option value="Festival">Festival</option>
                                    <option value="Others">Others</option>
                                </select>
                                <!-- <input type="text" id="description" name="description"><br> -->
                            </div>
                            <div class="input-box">
                                <span class="details" for="date" style="font-weight: 700;">Date :</span><br>
                                <input type="date" id="date" name="date"><br>
                            </div>
                            <div class="input-box">
                                <span class="details" for="place" style="font-weight: 700;">Place :</span><br>
                                <input type="text" id="place" name="place"><br>
                            </div>
                            <div class="input-box">
                                <span class="details" for="description" style="font-weight: 700;">Description :</span><br>
                                <input type="text" id="description" name="description"><br>
                            </div>
                            <div class="input-box">
                                <span class="details" for="description" style="font-weight: 700;">Image :</span><br>
                                <input type="file" id="image" name="image"><br>
                            </div>
                            <br>
                            <br>
                            <br>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="background-color: rgb(238, 238, 238);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button id="submit_event" type="submit" class="btn btn-primary" data-bs-dismiss="modal">Add</button>
                </div>
            </div>
        </div>
    </div>

<section id="blog" class="blog">
    <div class="d-flex justify-content-between align-items-center" style="padding-left: 140px; padding-right: 140px; padding-bottom: 30px;">
        <div>
            <h1>All Events</h1>
        </div>
    </div>

    <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="row gy-4 posts-list" id="cards">
        </div>
    </div>
</section>
{% endblock content %}